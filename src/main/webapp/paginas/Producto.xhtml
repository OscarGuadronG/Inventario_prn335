<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="componentes/Template.xhtml">
    <ui:define name="tituloFormulario">
        #{msg['sb.Producto']}
    </ui:define>
    <ui:define name="PanelTabla">
        <p:outputPanel id="panelTabla" rendered="#{productoFrm.estadoCrud eq 'Nada'}">
            <h:panelGroup id="tblBotones">
                <ui:include src="componentes/Botones-Top.xhtml">
                    <ui:param name="boton" value="nuevo"/>
                    <ui:param name="bean" value="#{productoFrm}"/>
                </ui:include>
            </h:panelGroup>
            <br/>
            <!-- Tabla Producto-->
            <p:dataTable id="tblDato" value="#{productoFrm.modelo}" var="r" lazy="true"
                         paginator="true" rows="10" selection="#{productoFrm.registro}"
                         selectionMode="single" rowKey="#{r.id}" selectionListener="#{productoFrm.selectionHandler}"
                         styleClass="ui-datatable">
                <p:ajax event="rowSelect"
                        listener="#{productoFrm.selectionHandler}"
                        update=":frmTabla :frmFormulario mensajes"/>
                <p:column headerText="ID Producto" style="width:320px" sortBy="#{r.id}">
                    <h:outputText value="#{r.id}"/>
                </p:column>
                <p:column headerText="Nombre Producto">
                    <h:outputText value="#{r.nombreProducto}"/>
                </p:column>
                <p:column headerText="Referencia Externa">
                    <h:outputText value="#{r.referenciaExterna}"/>
                </p:column>
                <p:column headerText="Estado">
                    <h:outputText value="#{r.activo ? msg['lbl.activo'] : msg['lbl.inactivo']}"/>
                </p:column>
            </p:dataTable>
        </p:outputPanel>
    </ui:define>
    <ui:define name="PanelEdicion">
        <p:outputPanel id="panelEdicion" rendered="#{productoFrm.estadoCrud ne 'Nada'}">
            <p:panel header="#{msg['lbl.formulario']} #{msg['sb.Producto']}" styleClass="panel">

                <p:tabView>
                    <p:tab title="Generalidades">
                        <p:panelGrid columns="2" columnClasses="etiqueta, campo" styleClass="formulario-grid">
                            <!-- Campos del formulario -->
                            <h:outputLabel value="#{productoFrm.registro.id}"/>
                            <p:outputLabel for="nombreProducto" value="Nombre Producto:"
                                           styleClass="etiqueta required"/>
                            <p:inputText id="nombreProducto" value="#{productoFrm.registro.nombreProducto}"
                                         required="true" requiredMessage="#{msg['msg.nombre']}"
                                         styleClass="campo-input"/>
                            <p:outputLabel for="referenciaExterna" value="Referencia Externa:" styleClass="etiqueta"/>
                            <p:inputText id="referenciaExterna" value="#{productoFrm.registro.referenciaExterna}"
                                         styleClass="campo-input"/>
                            <p:outputLabel for="activo" value="Estado:" styleClass="etiqueta"/>
                            <p:selectBooleanCheckbox id="activo" value="#{productoFrm.registro.activo}"
                                                     styleClass="campo-checkbox"/>
                            <p:outputLabel for="comentarios" value="Comentarios:" styleClass="etiqueta"/>
                            <p:inputTextarea id="comentarios" value="#{productoFrm.registro.comentarios}"
                                             styleClass="campo-textarea" rows="2"/>
                        </p:panelGrid>
                        <br/>
                        <h:panelGroup id="BtnEdicion" layout="Block" styleClass="panel-botones">
                            <ui:include src="componentes/Botones-Top.xhtml">
                                <ui:param name="boton" value="ediciones"/>
                                <ui:param name="bean" value="#{productoFrm}"/>
                            </ui:include>
                        </h:panelGroup>
                    </p:tab>
                    <p:tab title="Tipo de Producto" disabled="#{productoFrm.estadoCrud eq 'Crear'}"
                           id="tab2">
                        <p:outputPanel id="PanelTablaC" rendered="#{productoFrm.estadoSubFormulario eq 'Nada'}">
                            <p:commandButton value="#{msg['btn.nuevo']}"
                                             icon="pi pi-plus"
                                             action="#{productoFrm.SubBtnNuevo}"
                                             update="tab2 mensajes"
                                             process="@this"
                                             styleClass="ui-button"/>
                            <p:dataTable id="tblDatos" value="#{productoFrm.listaDetalle}"
                                         var="ptp" selectionMode="single" selection="#{productoFrm.detalle}"
                                         rowKey="#{ptp.id}"
                                         emptyMessage="No hay Tipos registradas para este producto"
                                         styleClass="ui-datatable">
                                <p:ajax event="rowSelect" update="tab2 mensajes"
                                        listener="#{productoFrm.subSelectionHandler}"/>
                                <p:column headerText="ID" style="width: 80px;" sortBy="#{ptp.id}">
                                    <h:outputText value="#{ptp.id}"/>
                                </p:column>
                                <p:column headerText="Tipo Producto">
                                    <h:outputText value="#{ptp.idTipoProducto.nombre}"/>
                                </p:column>
                                <p:column headerText="Fecha Creación" sortBy="#{ptp.fechaCreacion}">
                                    <h:outputText value="#{ptp.fechaCreacion}">
                                        <f:converter converterId="offsetDateTimeConverter"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Estado" style="width: 100px;">
                                    <h:outputText value="#{ptp.activo ? 'Activo' : 'Inactivo'}"/>
                                </p:column>
                                <p:column headerText="Observaciones" sortBy="#{ptp.observaciones}">
                                    <h:outputText value="#{ptp.observaciones}"/>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                        <p:outputPanel id="panelEdicionC" rendered="#{productoFrm.estadoSubFormulario ne 'Nada'}">
                            <p:panel header="#{msg['lbl.formulario']} " styleClass="panel">
                                <p:panelGrid columns="2" columnClasses="etiqueta, campo"
                                             styleClass="formulario-grid">
                                    <!-- Campos del formulario -->
                                    <h:outputLabel value="id: #{productoFrm.detalle.id}"/>
                                    <p:outputLabel for="fechaCreacion" value="Fecha Creación:"/>
                                    <p:datePicker id="fechaCreacion" value="#{productoFrm.detalle.fechaCreacion}"
                                                  showTime="true" hourFormat="24"
                                                  timeInput="true" timeZone="America/El_Salvador"
                                                  pattern="yyyy-MM-dd'T'HH:mm" converter="offsetDateTimeConverter"
                                                  required="true" requiredMessage="La fecha es obligatoria"
                                                  touchUI="false"/>
                                    <p:outputLabel for="TipoProducto" value="Tipo Producto:"/>
                                    <p:autoComplete id="idTipoProducto" value="#{productoFrm.detalle.idTipoProducto}"
                                                    required="true"
                                                    completeMethod="#{productoFrm.completarTipoProducto}" var="tipo"
                                                    itemLabel="#{tipo.nombre}" itemValue="#{tipo}"
                                                    converter="tipoProductoConverter" dropdown="true"
                                                    forceSelection="true" placeholder="Seleccione un tipo de producto"
                                                    requiredMessage="#{msg['msg.tipoProducto']}"/>
                                    <h:outputLabel for="activo1" value="#{msg['lbl.estado']}:"/>
                                    <p:selectBooleanCheckbox id="activo1"
                                                             value="#{productoFrm.registro.activo}"
                                                             styleClass="campo-checkbox"/>
                                    <h:outputLabel for="observaciones" value="Observaciones"/>
                                    <p:inputTextarea id="observaciones"
                                                     value="#{productoFrm.registro.comentarios}"
                                                     styleClass="campo-textarea" rows="2"/>

                                        <h:outputLabel for="caracteristicasPickList" value="Características:"
                                                       styleClass="etiqueta"/>
                                        <p:pickList id="caracteristicasPickList"
                                                    value="#{productoTipoProductoCaracteristicaFrm.caracteristicasModel}"
                                                    converter="tipoProductoCaracteristicaConverter"
                                                    var="caracteristica"
                                                    itemLabel="#{caracteristica.idCaracteristica.nombre}"
                                                    itemValue="#{caracteristica}"
                                                    showSourceControls="false"
                                                    showTargetControls="false"
                                                    responsive="true"
                                                    style="width:100%; height:200px"
                                                    rendered="#{productoTipoProductoFrm.registro.idTipoProducto != null}">
                                            <f:facet name="sourceCaption">Disponibles</f:facet>
                                            <f:facet name="targetCaption">Asignadas</f:facet>
                                        </p:pickList>

                                </p:panelGrid>
                                <p:commandButton value="#{msg['btn.guardar']}" icon="pi pi-save"
                                                 action="#{productoFrm.subBtnGuardar}"
                                                 update=":frmFormulario mensajes"
                                                 process="@form" styleClass="ui-button-success"/>
                                <p:commandButton value="#{msg['btn.eliminar']}" icon="pi pi-trash"
                                                 action="#{productoFrm.subBtnEliminar}"
                                                 update=":frmFormulario mensajes"
                                                 process="@this" styleClass="ui-button-danger"
                                                 rendered="#{productoFrm.estadoSubFormulario eq 'Modificar'}"/>
                                <p:commandButton value="#{msg['btn.cancelar']}" icon="pi pi-times"
                                                 action="#{productoFrm.subBtnCancelar}"
                                                 update=":frmFormulario mensajes"
                                                 process="@this" styleClass="ui-button-secondary"/>
                            </p:panel>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>

            </p:panel>
        </p:outputPanel>
    </ui:define>
</ui:composition>
</html>
