<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="componentes/Template.xhtml">
    <ui:define name="tituloFormulario">
        #{msg['sb.Productos']}
    </ui:define>
    <ui:define name="PanelTabla">
        <p:outputPanel id="panelTabla" rendered="#{productoFrm.estadoCrud eq 'Nada'}">
            <h:panelGroup id="tblBotones">
                <ui:include src="componentes/Botones-Top.xhtml">
                    <ui:param name="boton" value="nuevo"/>
                    <ui:param name="bean" value="#{productoFrm}"/>
                </ui:include>
            </h:panelGroup>
            <br/>
            <!-- Tabla Producto-->

            <p:dataTable id="tblDato" value="#{productoFrm.modelo}" var="r" lazy="true"
                         rendered="#{productoFrm.estadoCrud eq 'Nada'}"
                         paginator="true" rows="10" selection="#{productoFrm.registro}"
                         selectionMode="single" rowKey="#{r.id}" selectionListener="#{productoFrm.selectionHandler}"
                         styleClass="ui-datatable">

                <p:ajax event="rowSelect"
                        listener="#{productoFrm.selectionHandler}"
                        update=":frmTabla :frmFormulario mensajes"/>

                <p:column headerText="ID Producto" style="width:320px" sortBy="#{r.id}">
                    <h:outputText value="#{r.id}" />
                </p:column>

                <p:column headerText="Nombre Producto" >
                    <h:outputText value="#{r.nombreProducto}" />
                </p:column>

                <p:column headerText="Referencia Externa" >
                    <h:outputText value="#{r.referenciaExterna}" />
                </p:column>

                <p:column headerText="Estado" >
                    <h:outputText value="#{r.activo ? msg['lbl.activo'] : msg['lbl.inactivo']}" />
                </p:column>

            </p:dataTable>
        </p:outputPanel>
    </ui:define>
    <ui:define name="PanelEdicion">
        <p:outputPanel id="panelEdicion" rendered="#{productoFrm.estadoCrud ne 'Nada'}">
            <p:panel header="#{msg['lbl.formulario']} #{msg['sb.Producto']}" styleClass="panel">
                <p:tabView>
                    <p:tab title="Generalidades">
                        <p:panelGrid columns="2" columnClasses="etiqueta, campo" styleClass="formulario-grid">
                            <!-- Campos del formulario -->
                            <h:outputLabel value=" "/>

                            <h:outputLabel for="producto" value="ID Producto: " styleClass="etiqueta required" disabled="true" rendered="#{productoFrm.estadoCrud ne 'Crear'}"/>
                            <p:inputText id="producto" value="#{productoFrm.registro.id}" required="true" disabled="true" rendered="#{productoFrm.estadoCrud ne 'Crear'}"
                                         requiredMessage="#{msg['msg.nombre']}" styleClass="campo-input" />

                            <p:outputLabel for="nombreProducto" value="Nombre Producto:" styleClass="etiqueta required"/>
                            <p:inputText id="nombreProducto" value="#{productoFrm.registro.nombreProducto}"
                                         required="true" requiredMessage="#{msg['msg.nombre']}"
                                         styleClass="campo-input" maxlength="155"/>

                            <p:outputLabel for="referenciaExterna" value="Referencia Externa:" styleClass="etiqueta"/>
                            <p:inputText id="referenciaExterna" value="#{productoFrm.registro.referenciaExterna}"
                                         styleClass="campo-input"/>

                            <p:outputLabel for="activo" value="Estado:" styleClass="etiqueta"/>
                            <p:selectBooleanCheckbox id="activo" value="#{productoFrm.registro.activo}"
                                                     styleClass="campo-checkbox"/>

                            <p:outputLabel for="comentarios" value="Comentarios:" styleClass="etiqueta"/>
                            <p:inputTextarea id="comentarios" value="#{productoFrm.registro.comentarios}"
                                             styleClass="campo-textarea" rows="3"/>

                        </p:panelGrid>
                        <br/>
                        <h:panelGroup id="BtnEdicion" layout="Block" styleClass="panel-botones">
                            <ui:include src="componentes/Botones-Top.xhtml">
                                <ui:param name="boton" value="ediciones"/>
                                <ui:param name="bean" value="#{productoFrm}"/>
                            </ui:include>
                        </h:panelGroup>
                    </p:tab>

                    <p:tab title="Tipo Producto" id="tab2">
                        <p:dataTable id="tblTipos"
                                     value="#{productoTipoProductoFrm.findByProducto(productoFrm.registro.id)}"  var="relacion"
                                     lazy="true" paginator="true" rows="5"
                                     rowsPerPageTemplate="5,10,20"
                                     currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                     paginatorPosition="bottom"
                                     emptyMessage="No hay relaciones producto-tipo registradas"
                                     styleClass="table-modern"
                                     selectionMode="single"
                                     selection="#{productoTipoProductoFrm.registro}"
                                     rendered="#{productoTipoProductoFrm.estadoCrud eq 'Nada'}"
                                     rowKey="#{relacion.id}">

                            <p:ajax event="rowSelect"
                                    listener="#{productoTipoProductoFrm.selectionHandler}"
                                    update="tab2" />

                            <p:column headerText="ID" style="width: 80px;" sortBy="#{relacion.id}">
                                <h:outputText value="#{relacion.id}" />
                            </p:column>



                            <p:column headerText="Tipo Producto">
                                <h:outputText value="#{relacion.idTipoProducto.nombre}" />
                            </p:column>

                            <p:column headerText="Fecha Creación" sortBy="#{relacion.fechaCreacion}">
                                <h:outputText value="#{relacion.fechaCreacion}">
                                    <f:converter converterId="offsetDateTimeConverter" />
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Estado" style="width: 100px;">
                                <h:outputText value="#{relacion.activo ? 'Activo' : 'Inactivo'}" />
                            </p:column>

                            <p:column headerText="Observaciones" sortBy="#{relacion.observaciones}">
                                <h:outputText value="#{relacion.observaciones}" />
                            </p:column>

                        </p:dataTable>
                        <p:commandButton value="Agregar Tipo" icon="pi pi-plus"
                                         action="#{productoTipoProductoFrm.btnNuevo()}"
                                         update=":frmFormulario"
                                         immediate="true"
                                         styleClass="p-button p-button-nuevo"
                        >
                        </p:commandButton>

                        <p:outputPanel id="panelEdicion2" rendered="#{productoTipoProductoFrm.estadoCrud ne 'Nada'}">
                            <p:panel header="Tipo de Producto" styleClass="panel">
                                <p:panelGrid columns="2" columnClasses="etiqueta, campo" styleClass="formulario-grid">

                                    <!-- Campos del formulario -->
                                    <h:outputLabel value=" "/>
                                    <p:outputLabel for="p" value="ID producto" />
                                    <p:inputText id="p"
                                                 value="#{productoFrm.registro.id}"
                                                 disabled="true"
                                                 styleClass="campo-input"
                                                />

                                    <p:outputLabel for="fechaCreacion" value="Fecha Creación:" />
                                    <p:inputText id="fechaCreacion"
                                                 value="#{productoTipoProductoFrm.registro.fechaCreacion}"
                                                 disabled="true"
                                                 styleClass="campo-input"
                                                 converter="offsetDateTimeConverter1"/>

                                    <p:outputLabel for="TipoProducto" value="id Tipo producto:" />
                                    <p:selectOneMenu id="TipoProducto"
                                                     value="#{productoTipoProductoFrm.registro.idTipoProducto}"
                                                     converter="tipoProductoConverter"

                                                     style="width: 100%">
                                        <f:selectItem itemLabel="-- Seleccione --"
                                                      itemValue="#{null}" />
                                        <f:selectItems value="#{tipoProductoFrm.findActivos()}"
                                                       var="tipo"
                                                       itemLabel="#{tipo.nombre}"
                                                       itemValue="#{tipo}" />
                                        <p:ajax event="change"
                                                listener="#{productoTipoProductoFrm.onTipoProductoChange}"
                                                update="caracteristicasPickList @parent"/>
                                    </p:selectOneMenu>

                                    <h:outputLabel for="activo1" value="#{msg['lbl.estado']}:"/>
                                    <p:selectBooleanCheckbox id="activo1" value="#{productoTipoProductoFrm.registro.activo}"
                                                             styleClass="campo-checkbox"/>

                                    <h:outputLabel for="observaciones" value="Observaciones Tipo Producto"/>
                                    <p:inputTextarea id="observaciones" value="#{productoTipoProductoFrm.registro.observaciones}"
                                                     styleClass="campo-textarea" rows="3"/>


                                    <h:outputLabel for="caracteristicasPickList" value="Características:"
                                                   styleClass="etiqueta"
                                                   rendered="#{productoTipoProductoFrm.registro.idTipoProducto != null}"/>
                                    <p:pickList id="caracteristicasPickList"
                                                value="#{productoTipoProductoCaracteristicaFrm.caracteristicasModel}"
                                                converter="tipoProductoCaracteristicaConverter"
                                                var="caracteristica"
                                                itemLabel="#{caracteristica.idCaracteristica.nombre}"
                                                itemValue="#{caracteristica}"
                                                showSourceControls="false"
                                                showTargetControls="false"
                                                responsive="true"
                                                style="width:100%; height:200px"
                                                rendered="#{productoTipoProductoFrm.registro.idTipoProducto != null}">
                                        <f:facet name="sourceCaption">Disponibles</f:facet>
                                        <f:facet name="targetCaption">Asignadas</f:facet>
                                    </p:pickList>
                                    <h:outputLabel value=""/>

                                    <ui:include src="componentes/Botones-Top.xhtml">
                                        <ui:param name="boton" value="ediciones"/>
                                        <ui:param name="bean" value="#{productoTipoProductoFrm}"/>
                                    </ui:include>

                                </p:panelGrid>
                            </p:panel>
                        </p:outputPanel>

                    </p:tab>
                </p:tabView>
            </p:panel>
        </p:outputPanel>
    </ui:define>
</ui:composition>
</html>
