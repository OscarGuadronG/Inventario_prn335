<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="componentes/Template.xhtml">
    <ui:define name="tituloFormulario">
        #{msg['sb.TipoProducto']}
    </ui:define>
    <ui:define name="PanelTabla">
        <p:outputPanel id="panelTabla" rendered="#{tipoProductoFrm.estadoCrud eq 'Nada'}">
            <h:panelGroup id="tblBotones">
                <ui:include src="componentes/Botones-Top.xhtml">
                    <ui:param name="boton" value="nuevo"/>
                    <ui:param name="bean" value="#{tipoProductoFrm}"/>
                </ui:include>
            </h:panelGroup>
            <br/>
            <p:treeTable value="#{tipoProductoFrm.arbol}" var="tp" styleClass="ui-datatable"
                         selectionMode="single"
                         selection="#{tipoProductoFrm.nodoSeleccionado}"
                         rowKey="#{tp.id}">
                <p:ajax event="select" update=":frmTabla :frmFormulario mensajes"
                        listener="#{tipoProductoFrm.oneSelectNodo}"/>
                <p:column headerText="#{msg['lbl.id']}">
                    <h:outputText value="#{tp.id}"/>
                </p:column>
                <p:column headerText="#{msg['lbl.nombre']}">
                    <h:outputText value="#{tp.nombre}"/>
                </p:column>
                <p:column headerText="#{msg['lbl.estado']}">
                    <h:outputText value="#{tp.activo?msg['lbl.activo']:msg['lbl.inactivo']}"/>
                </p:column>
                <p:column headerText="#{msg['lbl.comentarios']}">
                    <h:outputText value="#{tp.comentarios}"/>
                </p:column>
            </p:treeTable>
        </p:outputPanel>
    </ui:define>
    <ui:define name="PanelEdicion">
        <p:outputPanel id="panelEdicion" rendered="#{tipoProductoFrm.estadoCrud ne 'Nada'}">
            <p:panel header="#{msg['lbl.formulario']} #{msg['sb.TipoProducto']}" styleClass="panel">
                <p:tabView>
                    <p:tab title="Generalidades">
                        <p:panelGrid columns="2" columnClasses="etiqueta, campo" styleClass="formulario-grid">
                            <h:outputLabel for="nombre" value="#{msg['lbl.nombre']}:" styleClass="etiqueta required"/>
                            <p:inputText id="nombre" value="#{tipoProductoFrm.registro.nombre}" required="true"
                                         requiredMessage="#{msg['msg.nombre']}" styleClass="campo-input"/>

                            <h:outputLabel for="activo" value="#{msg['lbl.estado']}:"/>
                            <p:selectBooleanCheckbox id="activo" value="#{tipoProductoFrm.registro.activo}"
                                                     styleClass="campo-checkbox"/>

                            <h:outputLabel for="comentarios" value="#{msg['lbl.comentarios']}:"/>
                            <p:inputTextarea id="comentarios" value="#{tipoProductoFrm.registro.comentarios}"
                                             styleClass="campo-textarea" rows="3"/>

                            <h:outputLabel for="tipoProductoPadre" value="Tipo Padre:"/>

                                <p:autoComplete id="tipoProductoPadre" value="#{tipoProductoFrm.registro.idTipoProductoPadre}"
                                                completeMethod="#{tipoProductoFrm.completarTipoProducto}" var="tipo"
                                                itemLabel="#{tipoProductoFrm.armarJerarquia(tipo)}"
                                                itemValue="#{tipo}"
                                                converter="tipoProductoConverter" dropdown="true"
                                                forceSelection="true" placeholder="Seleccione un tipo de producto padre"/>

                        </p:panelGrid>
                        <br/>
                        <h:panelGroup id="BtnEdicion" layout="Block" styleClass="panel-botones">
                            <ui:include src="componentes/Botones-Top.xhtml">
                                <ui:param name="boton" value="ediciones"/>
                                <ui:param name="bean" value="#{tipoProductoFrm}"/>
                            </ui:include>
                        </h:panelGroup>
                    </p:tab>

                    <p:tab title="Tipo Producto Caracteristica" disabled="#{tipoProductoFrm.estadoCrud eq 'Crear'}"
                           id="tab2">
                        <ui:remove>
                        <p:commandButton value="Nueva Caracteristica"
                                         action="#{tipoProductoCaracteristicaFrm.btnNuevo}"
                                         update="tab2"
                                         process="@this"/>
                        <p:dataTable id="tblCaracteristicas"
                                     value="#{tipoProductoCaracteristicaFrm.findByTipoProductoId(tipoProductoFrm.registro.id)}"
                                     var="caracteristica"
                                     lazy="true" paginator="true" rows="5"
                                     rendered="#{tipoProductoCaracteristicaFrm.estadoCrud eq 'Nada'}"
                                     currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                     paginatorPosition="bottom"
                                     emptyMessage="No hay características registradas para este tipo de producto"
                                     styleClass="ui-datatable"
                                     selectionMode="single"
                                     selection="#{tipoProductoCaracteristicaFrm.registro}"
                                     rowKey="#{caracteristica.id}">

                            <p:ajax event="rowSelect"
                                    listener="#{tipoProductoCaracteristicaFrm.selectionHandler}"
                                    update="frmFormulario" />

                        <!-- Definición de columnas -->

                            <p:column headerText="ID" style="width: 80px;" sortBy="#{caracteristica.id}">
                                <h:outputText value="#{caracteristica.id}" />
                            </p:column>

                            <p:column headerText="Característica">
                                <h:outputText value="#{caracteristica.idCaracteristica.nombre}" />
                            </p:column>

                            <p:column headerText="Obligatorio" style="width: 100px;">
                                <h:outputText value="#{caracteristica.obligatorio ? 'Sí' : 'No'}" />
                            </p:column>

                            <p:column headerText="Fecha Creación" sortBy="#{caracteristica.fechaCreacion}">
                                <h:outputText value="#{caracteristica.fechaCreacion}">
                                    <f:converter converterId="offsetDateTimeConverter" />
                                </h:outputText>
                            </p:column>

                        </p:dataTable>

                        <p:outputPanel id="panelEdicionC" >
                            <p:panel header="#{msg['lbl.formulario']} " styleClass="panel" rendered="#{tipoProductoCaracteristicaFrm.estadoCrud ne 'Nada'}">

                                <p:outputLabel for="fechaCreacion" value="Fecha Creación:" />
                                <p:inputText id="fechaCreacion"
                                             value="#{tipoProductoCaracteristicaFrm.registro.fechaCreacion}"
                                             disabled="true"
                                             styleClass="campo-input"
                                             converter="offsetDateTimeConverter1"/>
                                <p:outputLabel for="Producto" value="Producto:" />
                                <p:inputText id="Producto"
                                             value="#{tipoProductoCaracteristicaFrm.registro.idTipoProducto.nombre}"
                                             disabled="true"
                                             styleClass="campo-input"
                                             />

                                <h:outputLabel for="activoU" value="Obligatorio:"/>
                                <p:selectBooleanCheckbox id="activoU" value="#{tipoProductoCaracteristicaFrm.registro.obligatorio}"
                                                         styleClass="campo-checkbox"/>

                                <h:outputLabel for="Caracteristica" value="Caracteristica: "/>
                                <p:selectOneMenu id="Caracteristica"
                                                 value="#{tipoProductoCaracteristicaFrm.registro.idCaracteristica}"
                                                 converter="caracteristicaConverter"
                                                 style="width: 100%">
                                    <f:selectItem itemLabel="Seleccione" />
                                    <f:selectItems value="#{caracteristicaFrm.listaCompleta}"
                                                   var="tipo"
                                                   itemLabel="#{tipo.nombre}"
                                                   itemValue="#{tipo}" />
                                </p:selectOneMenu>

                                <h:outputLabel value=""/>

                                <ui:include src="componentes/Botones-Top.xhtml">
                                    <ui:param name="boton" value="ediciones"/>
                                    <ui:param name="bean" value="#{tipoProductoCaracteristicaFrm}"/>
                                </ui:include>
                            </p:panel>
                        </p:outputPanel>
                        </ui:remove>
                    </p:tab>
                </p:tabView>
            </p:panel>
        </p:outputPanel>
    </ui:define>
</ui:composition>
</html>