<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="componentes/Template.xhtml">
    <ui:define name="tituloFormulario">
        #{msg['sb.TipoProducto']}
    </ui:define>
    <ui:define name="PanelTabla">
        <p:outputPanel id="panelTabla" rendered="#{tipoProductoFrm.estadoCrud eq 'Nada'}">
            <h:panelGroup id="tblBotones">
                <ui:include src="componentes/Botones-Top.xhtml">
                    <ui:param name="boton" value="nuevo"/>
                    <ui:param name="bean" value="#{tipoProductoFrm}"/>
                </ui:include>
            </h:panelGroup>
            <br/>
            <p:treeTable value="#{tipoProductoFrm.arbol}" var="tp" styleClass="ui-datatable"
                         selectionMode="single"
                         selection="#{tipoProductoFrm.nodoSeleccionado}"
                         rowKey="#{tp.id}">
                <p:ajax event="select" update=":frmTabla :frmFormulario mensajes"
                        listener="#{tipoProductoFrm.oneSelectNodo}"/>
                <p:column headerText="#{msg['lbl.id']}">
                    <h:outputText value="#{tp.id}"/>
                </p:column>
                <p:column headerText="#{msg['lbl.nombre']}">
                    <h:outputText value="#{tp.nombre}"/>
                </p:column>
                <p:column headerText="#{msg['lbl.estado']}">
                    <h:outputText value="#{tp.activo?msg['lbl.activo']:msg['lbl.inactivo']}"/>
                </p:column>
                <p:column headerText="#{msg['lbl.comentarios']}">
                    <h:outputText value="#{tp.comentarios}"/>
                </p:column>
            </p:treeTable>
        </p:outputPanel>
    </ui:define>
    <ui:define name="PanelEdicion">
        <p:outputPanel id="panelEdicion" rendered="#{tipoProductoFrm.estadoCrud ne 'Nada'}">
            <p:panel header="#{msg['lbl.formulario']} #{msg['sb.TipoProducto']}" styleClass="panel">
                <p:tabView id="tabView">
                    <p:tab title="Generalidades">
                        <p:panelGrid columns="2" columnClasses="etiqueta, campo" styleClass="formulario-grid">
                            <h:outputLabel for="nombre" value="#{msg['lbl.nombre']}:" styleClass="etiqueta required"/>
                            <p:inputText id="nombre" value="#{tipoProductoFrm.registro.nombre}" required="true"
                                         requiredMessage="#{msg['msg.nombre']}" styleClass="campo-input"/>

                            <h:outputLabel for="activo" value="#{msg['lbl.estado']}:"/>
                            <p:selectBooleanCheckbox id="activo" value="#{tipoProductoFrm.registro.activo}"
                                                     styleClass="campo-checkbox"/>

                            <h:outputLabel for="comentarios" value="#{msg['lbl.comentarios']}:"/>
                            <p:inputTextarea id="comentarios" value="#{tipoProductoFrm.registro.comentarios}"
                                             styleClass="campo-textarea" rows="3"/>

                            <h:outputLabel for="tipoProductoPadre" value="Tipo Padre:"/>

                            <p:autoComplete id="tipoProductoPadre"
                                            value="#{tipoProductoFrm.registro.idTipoProductoPadre}"
                                            completeMethod="#{tipoProductoFrm.completarTipoProducto}" var="tipo"
                                            itemLabel="#{tipoProductoFrm.armarJerarquia(tipo)}"
                                            itemValue="#{tipo}"
                                            converter="tipoProductoConverter" dropdown="true"
                                            forceSelection="true" placeholder="Seleccione un tipo de producto padre"/>

                        </p:panelGrid>
                        <br/>
                        <h:panelGroup id="BtnEdicion" layout="Block" styleClass="panel-botones">
                            <ui:include src="componentes/Botones-Top.xhtml">
                                <ui:param name="boton" value="ediciones"/>
                                <ui:param name="bean" value="#{tipoProductoFrm}"/>
                            </ui:include>
                        </h:panelGroup>
                    </p:tab>

                    <p:tab title="Tipo Producto Caracteristica" disabled="#{tipoProductoFrm.estadoCrud eq 'Crear'}"
                           id="tab2">
                        <p:outputPanel id="PanelTablaC" rendered="#{tipoProductoFrm.estadoSubFormulario eq 'Nada'}">
                            <p:commandButton value="#{msg['btn.nuevo']}"
                                             icon="pi pi-plus"
                                             action="#{tipoProductoFrm.SubBtnNuevo}"
                                             update="tab2 mensajes"
                                             process="@this"
                                             styleClass="ui-button"/>
                            <p:dataTable id="tblCaracteristicas"
                                         value="#{tipoProductoFrm.listaDetalle}"
                                         var="cr"
                                         selectionMode="single"
                                         selection="#{tipoProductoFrm.detalle}"
                                         rowKey="#{cr.id}"
                                         emptyMessage="No hay características registradas para este tipo de producto"
                                         styleClass="ui-datatable">
                                <p:ajax event="rowSelect" update="tab2 mensajes"
                                        listener="#{tipoProductoFrm.subSelectionHandler}"/>
                                <p:column headerText="ID" style="width: 80px;" sortBy="#{cr.id}">
                                    <h:outputText value="#{cr.id}"/>
                                </p:column>

                                <p:column headerText="Característica">
                                    <h:outputText value="#{cr.idCaracteristica.nombre}"/>
                                </p:column>

                                <p:column headerText="Obligatorio" style="width: 100px;">
                                    <h:outputText value="#{cr.obligatorio ? 'Sí' : 'No'}"/>
                                </p:column>

                                <p:column headerText="Fecha Creación" sortBy="#{cr.fechaCreacion}">
                                    <h:outputText value="#{cr.fechaCreacion}">
                                        <f:converter converterId="offsetDateTimeConverter"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                        <p:outputPanel id="panelEdicionC" rendered="#{tipoProductoFrm.estadoSubFormulario ne 'Nada'}">
                            <p:panel header="#{msg['lbl.formulario']} " styleClass="panel">
                                <p:outputLabel for="dpFechaCreacion" value="Fecha de creación"/>
                                <p:datePicker id="dpFechaCreacion"
                                              value="#{tipoProductoFrm.detalle.fechaCreacion}"
                                              showTime="true"
                                              hourFormat="24"
                                              timeInput="true"
                                              timeZone="America/El_Salvador"
                                              pattern="yyyy-MM-dd'T'HH:mm"
                                              converter="offsetDateTimeConverter"
                                              required="true"
                                              requiredMessage="La fecha es obligatoria"
                                              touchUI="false" />
                                <h:outputLabel for="obligatorio" value="Obligatorio:"/>
                                <p:selectBooleanCheckbox id="obligatorio" value="#{tipoProductoFrm.detalle.obligatorio}"
                                                         styleClass="campo-checkbox"/>
                                <h:outputLabel for="idCaracteristica" value="Caracteristica: "/>
                                <p:autoComplete id="idCaracteristica" value="#{tipoProductoFrm.detalle.idCaracteristica}" required="true"
                                                completeMethod="#{tipoProductoFrm.autocompletarCaracteristica}" var="tipo"
                                                itemLabel="#{tipo.nombre}" itemValue="#{tipo}"
                                                converter="caracteristicaConverter" dropdown="true"
                                                forceSelection="true" placeholder="Seleccione una caracteristica"
                                                requiredMessage="#{msg['msg.tipoAlmacen']}"/>
                                <h:outputLabel value=""/>
                            </p:panel>
                            <br/>
                            <p:commandButton value="#{msg['btn.guardar']}" icon="pi pi-save"
                                             action="#{tipoProductoFrm.subBtnGuardar}"
                                             update=":frmFormulario mensajes"
                                             process="@form" styleClass="ui-button-success" />
                            <p:commandButton value="#{msg['btn.eliminar']}" icon="pi pi-trash"
                                             action="#{tipoProductoFrm.subBtnEliminar}"
                                             update=":frmFormulario mensajes"
                                             process="@this" styleClass="ui-button-danger"
                                             rendered="#{tipoProductoFrm.estadoSubFormulario eq 'Modificar'}"/>
                            <p:commandButton value="#{msg['btn.cancelar']}" icon="pi pi-times"
                                             action="#{tipoProductoFrm.subBtnCancelar}"
                                             update=":frmFormulario mensajes"
                                             process="@this" styleClass="ui-button-secondary"/>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>
            </p:panel>
        </p:outputPanel>
    </ui:define>
</ui:composition>
</html>